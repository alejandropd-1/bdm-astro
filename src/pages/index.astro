---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Hero from '../components/Hero.astro';
import ServiceCard from '../components/ServiceCard.astro';
import ClientLogos from '../components/ClientLogos.astro';
import Footer from '../components/Footer.astro';
import OffCanvas from '../components/OffCanvas.astro';

// Import service images for optimization
import homeAdmPersonal from '../assets/images/home-adm-personal.jpg';
import homeNosotros from '../assets/images/home-nosotros.jpg';
import homeCompensaciones from '../assets/images/home-compensaciones.jpg';
import homeConsultoria from '../assets/images/home-consultoria.jpg';
import homeCapitalHumano from '../assets/images/home-capital-humano.jpg';

// Map image paths to imported assets
const imageMap = {
  '/images/home-adm-personal.jpg': homeAdmPersonal,
  '/images/home-nosotros.jpg': homeNosotros,
  '/images/home-compensaciones.jpg': homeCompensaciones,
  '/images/home-consultoria.jpg': homeConsultoria,
  '/images/home-capital-humano.jpg': homeCapitalHumano,
};

// Get services from markdown files
const allServices = await getCollection('services');
const featuredServices = allServices
  .filter(service => service.data.featured)
  .sort((a, b) => a.data.order - b.data.order);

// Map to the format expected by ServiceCard component
const services = featuredServices.map((service, index) => ({
  id: service.slug === 'administracion-personal' ? 'administracion-personal' : service.slug,
  title: service.data.title,
  description: service.data.homeDescription || service.data.description,
  image: imageMap[service.data.image] || service.data.image,
  link: `/services/${service.slug}/`,
  animationClass: index % 2 === 0 ? "uk-animation-slide-left-medium" : "uk-animation-slide-right-medium",
  reverse: index % 2 !== 0
}));
---

<Layout 
  title="BDM Consultores" 
  description="Desarrollamos el talento que impulsa el éxito. Consultora de recursos humanos especializada en reclutamiento, consultoría, compensaciones y administración de personal."
>
  <main>
    <!-- TOP -->
    <div class="top-wrap uk-position-relative uk-light uk-background-secondary">
      <!-- NAV -->
      <Header />
      <!-- /NAV -->

      <Hero />
    </div>
    <!-- /TOP -->

    <!-- CATEGORIES CONTAINER -->
    <div id="content" class="uk-container uk-section">
      {services.map((service) => (
        <ServiceCard {...service} />
      ))}
    </div>
    <!-- /CATEGORIES CONTAINER -->

    <!-- LOGOS -->
    <ClientLogos />
    <!-- /LOGOS -->

    <!-- FOOTER -->
    <Footer />
    <!-- /FOOTER -->

    <!-- OFFCANVAS -->
    <OffCanvas />
    <!-- /OFFCANVAS -->
  </main>
</Layout>
